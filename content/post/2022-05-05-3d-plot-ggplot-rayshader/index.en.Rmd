---
title: "Using rayshader for 3D plots in R Markdown"
author: "Federico Tiberti"
date: '2022-05-05'
slug: rayshader-plot
categories: R
image:
  caption: ''
  focal_point: ''
  preview_only: yes
tags:
- R Markdown
- 3d plot
- rayshader
---

```{r, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
lapply(c("tidyverse", "janitor", "sf", "rayshader", "colorspace"), require, character.only=T)
```

```{r}
radios <- read_sf("https://cdn.buenosaires.gob.ar/datosabiertos/datasets/informacion-censal-por-radio/informacion-censal-por-radio-2010.csv") %>% 
  clean_names() %>%
  mutate(across(c(comuna, fraccion, radio, total_pob, t_varon, t_mujer, t_vivienda, v_particul, v_colectiv, t_hogar, h_con_nbi, 
        h_sin_nbi, id), as.numeric)) %>% 
  rename(idradiocensal = id) %>% 
 mutate(nbi = h_con_nbi / t_hogar*100,
        nbi = h_con_nbi / t_hogar*100,
         nbi_trans=nbi+1, 
         nbi_trans = if_else(is.na(nbi_trans), 1, nbi_trans), 
         area = as.numeric(st_area(geometry)), 
         densidad = total_pob/area)

graph <-  radios %>% ggplot() +
  geom_sf(aes(fill=densidad), size=0.04) +
  scale_fill_continuous_sequential(palette="Reds 3") +
  coord_sf(datum=NA) + theme_minimal() +
  theme(axis.text.x = element_blank(),
        axis.text.y =   element_blank(),
        axis.ticks = element_blank()) 

plot_gg(graph, multicore = TRUE, width = 6 ,height=2.7, fov = 70)
```



